---
import Base from "../../layouts/Base.astro";
import PostItem from "../../components/PostItem.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const paths = posts.flatMap((post) => 
    post.data.tags?.map((tag) => ({ params: { tag } })) ?? []
  );
  return paths;
}

const posts = await getCollection("blog");
const { tag } = Astro.params;
const postsByTag = posts
  .filter((post) => post.data.tags?.includes(tag))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());
---

<Base 
  title={`标签: ${tag}`}
  description={`查看所有标记为 "${tag}" 的文章，共 ${postsByTag.length} 篇`}
  type="website"
  pagefind={{ filters: { 类型: '标签页', 标签: tag } }}
>
  <!-- 页面头部 -->
  <div class="my-8">
    <div class="text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white leading-tight mb-4 tracking-tight">
        标签: <span class="text-blue-600 dark:text-blue-400">#{tag}</span>
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto mb-6">
        找到 <span class="font-semibold">{postsByTag.length}</span> 篇相关文章
      </p>
      

  </div>

  <!-- 文章列表 -->
  {postsByTag.length > 0 ? (
    <div class="space-y-8">
      {postsByTag.map((post) => (
        <PostItem post={post} />
      ))}
    </div>
  ) : (
    <div class="text-center py-16">
      <div class="max-w-md mx-auto">
  <span class="icon-[ph--file-text] w-20 h-20 mx-auto mb-6 text-gray-400 dark:text-gray-600"></span>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
          暂无文章
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          标签 "#{tag}" 下还没有发布任何文章
        </p>
        <a 
          href="/blog"
          class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition-colors duration-200"
        >
          浏览所有文章
          <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        </a>
      </div>
    </div>
  )}

  <!-- 返回按钮 -->
  <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
      <a 
        href="/tags"
        class="inline-flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium transition-colors duration-200"
      >
  <span class="icon-[line-md--arrow-left] w-4 h-4 mr-2"></span>
        返回标签列表
      </a>
      
      <a 
        href="/blog"
        class="inline-flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300 font-medium transition-colors duration-200"
      >
        浏览所有文章
  <span class="icon-[line-md--arrow-right] w-4 h-4 ml-2"></span>
      </a>
    </div>
  </div>
</Base>
